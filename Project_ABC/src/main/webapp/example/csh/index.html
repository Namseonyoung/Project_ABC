<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Drag Drop Panels - Web Developer Plus Demos</title>
<script type="text/javascript" src="../../js/jquery-1.3.2.js" ></script>
<script type="text/javascript" src="../../js/jquery-ui-1.7.2.custom.min.js" ></script>
<link rel="stylesheet" type="text/css" href="styles.css" />
<script type="text/javascript" >

//xhr선언
var xhr1 = null;
var xmlDoc1 = null;

function getXHR() {//통신객체
  try {
	  if (window.XMLHttpRequest) 
	        return new XMLHttpRequest;
	  else if (window.ActiveXObject) 
		  return new ActiveXObject("MSXML2.XMLHTTP");
	  else 
		  return new ActiveXObject("Microsoft.XMLHTTP");
  }catch(e) {
	 xhr1=null; 
  }
 
} 
function serverKaja() { //통신가동
  xhr1 = getXHR();//new XHR
  xhr1.onreadystatechange = callback1;////
  xhr1.open("get", "menu.jsp", true);////
  xhr1.send(null);////
  
}
function callback1() {
  //var t1 = document.getElementById("t1");
   switch (xhr1.readyState) {
  
   case 4:
        //t1.value += "다 옴\n";
        if(xhr1.status==200){
        	 //t1.value += "정상으로 옴\n";
             xmlDoc1=xhr1.responseXML;
            
            xsl2=new ActiveXObject("Microsoft.XMLDOM");
           	xsl2.async=false;
           	xsl2.load("menu.xsl");
           	var  rDiv1=document.getElementById("rDiv1");
           	rDiv.innerHTML=xmlDoc1.transformNode(xsl2);
            
        }
        else
        	{
        	  //t1.value += "에러발생\n";
        	  //t1.value += xhr1.status+"\t"+xhr1.statusText+"\n";
        	
        	}
        break;
   }
}

function kajaInsert() {
	var root=xmlDoc1.documentElement;
	var menu=xmlDoc1.createElement("menu");
	var title=xmlDoc1.createElement("title");
	var price=xmlDoc1.createElement("price");
	var score=xmlDoc1.createElement("score");
	
	menu.appendChild(title);
	menu.appendChild(price);
	menu.appendChild(score);
	
	title.appendChild(xmlDoc1.createTextNode("짜장"));
	price.appendChild(xmlDoc1.createTextNode("4000"));
	score.appendChild(xmlDoc1.createTextNode("굿"));
	
	root.insertBefore(menu, root.childNodes[0]);
	
	xsl2=new ActiveXObject("Microsoft.XMLDOM");
   	xsl2.async=false;
   	xsl2.load("menu.xsl");
   	var  rDiv1=document.getElementById("rDiv1");
   	rDiv.innerHTML=xmlDoc1.transformNode(xsl2);
}


$(function(){
	
	xhr1 = getXHR();//new XHR
	xhr1.onreadystatechange = callback1;////
	//xhr1.open("get", "menu.jsp", true);////
	xhr1.send(null);////

	
	$('.dragbox')
	.each(function(){
		$(this).hover(function(){
			$(this).find('h2').addClass('collapse');
		}, function(){
			$(this).find('h2').removeClass('collapse');
		})
		.find('h2').hover(function(){
			$(this).find('.configure').css('visibility', 'visible');
		}, function(){
			$(this).find('.configure').css('visibility', 'hidden');
		})
		// =========toggle box========
		//.click(function(){
		//	$(this).siblings('.dragbox-content').toggle();
		//})
		.end()
		.find('.configure').css('visibility', 'hidden');
	});
	$('.column').sortable({
		connectWith: '.column',
		handle: 'h2',
		cursor: 'move',
		placeholder: 'placeholder',
		forcePlaceholderSize: true,
		opacity: 0.4,
		stop: function(event, ui){
			$(ui.item).find('h2').click();
			var sortorder='';
			$('.column').each(function(){
				var itemorder=$(this).sortable('toArray');
				var columnId=$(this).attr('id');
				sortorder+=columnId+'='+itemorder.toString()+'&';
			});
			
			//alert('SortOrder: '+sortorder);
			/*Pass sortorder variable to server using ajax to save state*/
		}
	})
	.disableSelection();
});





</script>
</head>


<body>
	<div id="rDiv">
	</div>
	<br>
	<h3> AJax Kaja</h3>
	<br>
	<input type="button" value="insert" onclick="kajaInsert()">
	<input type="button" value="서버로가자" onclick="serverKaja()">	
	
	<h3>Drag n Drop Panels</h3>
	

		<div class="column" id="column1">
			<div class="dragbox" id="item1" >
				<h2><a href="#" >Handle 1</a></h2>
				<div class="dragbox-content" >
					1111111111111
				</div>
			</div>
		</div>


		<div class="column" id="column2" >
			<div class="dragbox" id="item4" >
				<h2>Handle 4</h2>
				<div class="dragbox-content" >
					444444444
				</div>
			</div>
			<div class="dragbox" id="item5" >
				<h2>Handle 5</h2>
				<div class="dragbox-content" >
					5555555555555555
				</div>
			</div>
		</div>

 	
	
	</div>
	<hr style="clear:both;" />

</body>
</html>
